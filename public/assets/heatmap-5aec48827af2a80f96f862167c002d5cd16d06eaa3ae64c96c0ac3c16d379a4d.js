!function(t){var e=function(){var t=function(t){var e={data:[],heatmap:t};this.max=1,this.get=function(t){return e[t]},this.set=function(t,a){e[t]=a}};t.prototype={addDataPoint:function(t,e){if(!(t<0||e<0)){var a=this,i=a.get("heatmap"),n=a.get("data");return n[t]||(n[t]=[]),n[t][e]||(n[t][e]=0),n[t][e]+=arguments.length<3?1:arguments[2],a.set("data",n),a.max<n[t][e]?(i.get("actx").clearRect(0,0,i.get("width"),i.get("height")),void a.setDataSet({max:n[t][e],data:n},!0)):void i.drawAlpha(t,e,n[t][e],!0)}},setDataSet:function(t,e){var a=this,i=a.get("heatmap"),n=[],r=t.data,o=r.length;if(i.clear(),this.max=t.max,i.get("legend")&&i.get("legend").update(t.max),null!=e&&e){for(var s in r)if(void 0!==s)for(var l in r[s])void 0!==l&&i.drawAlpha(s,l,r[s][l],!1)}else for(;o--;){var d=r[o];i.drawAlpha(d.x,d.y,d.count,!1),n[d.x]||(n[d.x]=[]),n[d.x][d.y]||(n[d.x][d.y]=0),n[d.x][d.y]=d.count}i.colorize(),this.set("data",r)},exportDataSet:function(){var t=this,e=t.get("data"),a=[];for(var i in e)if(void 0!==i)for(var n in e[i])void 0!==n&&a.push({x:parseInt(i,10),y:parseInt(n,10),count:e[i][n]});return{max:t.max,data:a}},generateRandomDataSet:function(t){var e=this.get("heatmap"),a=e.get("width"),i=e.get("height"),n={},r=Math.floor(1e3*Math.random()+1);n.max=r;for(var o=[];t--;)o.push({x:Math.floor(Math.random()*a+1),y:Math.floor(Math.random()*i+1),count:Math.floor(Math.random()*r+1)});n.data=o,this.setDataSet(n)}};var e=function(t){this.config=t;var e={element:null,labelsEl:null,gradientCfg:null,ctx:null};this.get=function(t){return e[t]},this.set=function(t,a){e[t]=a},this.init()};e.prototype={init:function(){var t,e,a=this,i=a.config,n=i.title||"Legend",r=i.position,o=i.offset||10,s=(i.gradient,document.createElement("ul")),l="";a.processGradientObject(),l+=r.indexOf("t")>-1?"top:"+o+"px;":"bottom:"+o+"px;",l+=r.indexOf("l")>-1?"left:"+o+"px;":"right:"+o+"px;",t=document.createElement("div"),t.style.cssText="border-radius:5px;position:absolute;"+l+"font-family:Helvetica; width:256px;z-index:10000000000; background:rgba(255,255,255,1);padding:10px;border:1px solid black;margin:0;",t.innerHTML="<h3 style='padding:0;margin:0;text-align:center;font-size:16px;'>"+n+"</h3>",s.style.cssText="position:relative;font-size:12px;display:block;list-style:none;list-style-type:none;margin:0;height:15px;",e=document.createElement("div"),e.style.cssText=["position:relative;display:block;width:256px;height:15px;border-bottom:1px solid black; background-image:url(",a.createGradientImage(),");"].join(""),t.appendChild(s),t.appendChild(e),a.set("element",t),a.set("labelsEl",s),a.update(1)},processGradientObject:function(){var t=this,e=this.config.gradient,a=[];for(var i in e)e.hasOwnProperty(i)&&a.push({stop:i,value:e[i]});a.sort(function(t,e){return t.stop-e.stop}),a.unshift({stop:0,value:"rgba(0,0,0,0)"}),t.set("gradientArr",a)},createGradientImage:function(){var t,e=this,a=e.get("gradientArr"),i=a.length,n=document.createElement("canvas"),r=n.getContext("2d");n.width="256",n.height="15",t=r.createLinearGradient(0,5,256,10);for(var o=0;o<i;o++)t.addColorStop(1/(i-1)*o,a[o].value);r.fillStyle=t,r.fillRect(0,5,256,10),r.strokeStyle="black",r.beginPath();for(var o=0;o<i;o++)r.moveTo((1/(i-1)*o*256>>0)+.5,0),r.lineTo((1/(i-1)*o*256>>0)+.5,0==o?15:5);return r.moveTo(255.5,0),r.lineTo(255.5,15),r.moveTo(255.5,4.5),r.lineTo(0,4.5),r.stroke(),e.set("ctx",r),n.toDataURL()},getElement:function(){return this.get("element")},update:function(t){for(var e,a,i=this,n=i.get("gradientArr"),r=i.get("ctx"),o=i.get("labelsEl"),s="",l=0;l<n.length;l++)e=t*n[l].stop>>0,a=r.measureText(e).width/2>>0,0==l&&(a=0),l==n.length-1&&(a*=2),s+='<li style="position:absolute;left:'+(((1/(n.length-1)*l*256||0)>>0)-a+.5)+'px">'+e+"</li>";o.innerHTML=s}};var a=function(e){var a={radius:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},legend:null,visible:!0,width:0,height:0,max:!1,gradient:!1,opacity:180,premultiplyAlpha:!1,bounds:{l:1e3,r:0,t:1e3,b:0},debug:!1};this.store=new t(this),this.get=function(t){return a[t]},this.set=function(t,e){a[t]=e},this.configure(e),this.init()};return a.prototype={configure:function(t){var a=this;if(a.set("radius",t.radius||40),a.set("element",t.element instanceof Object?t.element:document.getElementById(t.element)),a.set("visible",null==t.visible||t.visible),a.set("max",t.max||!1),a.set("gradient",t.gradient||{.45:"rgb(0,0,0)",.55:"rgb(10,25,63)",.65:"rgb(11,0,224)",.95:"rgb(101,0,191)",1:"rgb(229,11,217)"}),a.set("opacity",parseInt(255/(100/t.opacity),10)||180),a.set("width",t.width||0),a.set("height",t.height||0),a.set("debug",t.debug),t.legend){var i=t.legend;i.gradient=a.get("gradient"),a.set("legend",new e(i))}},resize:function(){var t=this,e=t.get("element"),a=t.get("canvas"),i=t.get("acanvas");a.width=i.width=t.get("width")||e.style.width.replace(/px/,"")||t.getWidth(e),this.set("width",a.width),a.height=i.height=t.get("height")||e.style.height.replace(/px/,"")||t.getHeight(e),this.set("height",a.height)},init:function(){var t=this,e=document.createElement("canvas"),a=document.createElement("canvas"),i=e.getContext("2d"),n=a.getContext("2d"),r=t.get("element");t.initColorPalette(),t.set("canvas",e),t.set("ctx",i),t.set("acanvas",a),t.set("actx",n),t.resize(),e.style.cssText=a.style.cssText="position:absolute;top:0;left:0;z-index:10000000;",t.get("visible")||(e.style.display="none"),r.appendChild(e),t.get("legend")&&r.appendChild(t.get("legend").getElement()),t.get("debug")&&document.body.appendChild(a),n.shadowOffsetX=15e3,n.shadowOffsetY=15e3,n.shadowBlur=15},initColorPalette:function(){var t,e,a,i=this,n=document.createElement("canvas"),r=i.get("gradient");n.width="1",n.height="256",t=n.getContext("2d"),e=t.createLinearGradient(0,0,1,256),a=t.getImageData(0,0,1,1),a.data[0]=a.data[3]=64,a.data[1]=a.data[2]=0,t.putImageData(a,0,0),a=t.getImageData(0,0,1,1),i.set("premultiplyAlpha",a.data[0]<60||a.data[0]>70);for(var o in r)e.addColorStop(o,r[o]);t.fillStyle=e,t.fillRect(0,0,1,256),i.set("gradient",t.getImageData(0,0,1,256).data)},getWidth:function(t){var e=t.offsetWidth;return t.style.paddingLeft&&(e+=t.style.paddingLeft),t.style.paddingRight&&(e+=t.style.paddingRight),e},getHeight:function(t){var e=t.offsetHeight;return t.style.paddingTop&&(e+=t.style.paddingTop),t.style.paddingBottom&&(e+=t.style.paddingBottom),e},colorize:function(t,e){var a,i,n,r,o,s,l,d,g,h,c=this,u=c.get("width"),p=c.get("radius"),f=c.get("height"),m=c.get("actx"),v=c.get("ctx"),x=3*p,y=c.get("premultiplyAlpha"),b=c.get("gradient"),w=c.get("opacity"),C=c.get("bounds");null!=t&&null!=e?(t+x>u&&(t=u-x),t<0&&(t=0),e<0&&(e=0),e+x>f&&(e=f-x),a=t,i=e,r=t+x,n=e+x):(a=C.l<0?0:C.l,r=C.r>u?u:C.r,i=C.t<0?0:C.t,n=C.b>f?f:C.b),o=m.getImageData(a,i,r-a,n-i),s=o.data,l=s.length;for(var D=3;D<l;D+=4)d=s[D],g=4*d,g&&(h=d<w?d:w,s[D-3]=b[g],s[D-2]=b[g+1],s[D-1]=b[g+2],y&&(s[D-3]/=255/h,s[D-2]/=255/h,s[D-1]/=255/h),s[D]=h);o.data=s,v.putImageData(o,a,i)},drawAlpha:function(t,e,a,i){var n=this,r=n.get("radius"),o=n.get("actx"),s=(n.get("max"),n.get("bounds")),l=t-1.5*r>>0,d=e-1.5*r>>0,g=t+1.5*r>>0,h=e+1.5*r>>0;o.shadowColor="rgba(0,0,0,"+(a?a/n.store.max:"0.1")+")",o.shadowOffsetX=15e3,o.shadowOffsetY=15e3,o.shadowBlur=15,o.beginPath(),o.arc(t-15e3,e-15e3,r,0,2*Math.PI,!0),o.closePath(),o.fill(),i?n.colorize(l,d):(l<s.l&&(s.l=l),d<s.t&&(s.t=d),g>s.r&&(s.r=g),h>s.b&&(s.b=h))},toggleDisplay:function(){var t=this,e=t.get("visible"),a=t.get("canvas");e?a.style.display="none":a.style.display="block",t.set("visible",!e)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var t=this,e=t.get("width"),a=t.get("height");t.store.set("data",[]),t.get("ctx").clearRect(0,0,e,a),t.get("actx").clearRect(0,0,e,a)},cleanup:function(){var t=this;t.get("element").removeChild(t.get("canvas"))}},{create:function(t){return new a(t)},util:{mousePosition:function(t){var e,a;if(t.layerX?(e=t.layerX,a=t.layerY):t.offsetX&&(e=t.offsetX,a=t.offsetY),"undefined"!=typeof e)return[e,a]}}}}();t.h337=t.heatmapFactory=e}(window);